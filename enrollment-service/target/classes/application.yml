server:
  port: 8082

spring:
  application:
    name: enrollment-service
  cloud:
    compatibility-verifier:
      enabled: false
    nacos:
      discovery:
        server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
        namespace: ${NACOS_NAMESPACE:public}
        group: ${NACOS_GROUP:DEFAULT_GROUP}
  datasource:
    url: ${DB_URL:jdbc:h2:file:./data/enrollment}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}
    driver-class-name: ${DB_DRIVER:org.h2.Driver}
  jpa:
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update}
    show-sql: ${JPA_SHOW_SQL:true}
    properties:
      hibernate:
        format_sql: true
  h2:
    console:
      enabled: ${H2_CONSOLE_ENABLED:true}
      path: /h2-console

catalog-service:
  url: ${CATALOG_SERVICE_URL:http://localhost:8081}

# Feign 配置
feign:
  circuitbreaker:
    enabled: true
  client:
    config:
      default:
        connectTimeout: 3000
        readTimeout: 5000
        loggerLevel: FULL

# Resilience4j 熔断器配置
resilience4j:
  circuitbreaker:
    instances:
      catalog-service:
        # 滑动窗口大小（基于请求次数）
        slidingWindowSize: 10
        # 最小调用次数（达到这个次数后才开始计算失败率）
        minimumNumberOfCalls: 5
        # 失败率阈值（50%）
        failureRateThreshold: 50
        # 慢调用时长阈值（毫秒）
        slowCallDurationThreshold: 5000
        # 慢调用率阈值
        slowCallRateThreshold: 50
        # 等待时长（熔断器打开后等待多久尝试半开状态）
        waitDurationInOpenState: 10s
        # 半开状态下的请求数
        permittedNumberOfCallsInHalfOpenState: 3
        # 滑动窗口类型：COUNT_BASED（基于次数）或 TIME_BASED（基于时间）
        slidingWindowType: COUNT_BASED
        # 自动从半开状态转换到打开或关闭状态
        automaticTransitionFromOpenToHalfOpenEnabled: true

logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    com.zjgsu.wzy.enrollment.client: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: health,info,nacos-discovery,circuitbreakers,circuitbreakerevents
  endpoint:
    health:
      show-details: always
  health:
    circuitbreakers:
      enabled: true
